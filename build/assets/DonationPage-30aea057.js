import{j as e,k,r as f,u as A,B as y,m as N}from"./index-4c963416.js";import{P as i}from"./index-e95a995e.js";import{a as P}from"./Config-0cd071a0.js";const Y={MTN_MOBILE_MONEY:"13",TELECEL:"6",AIRTELTIGO_MONEY:"7"},p={INITIATE:"initiate",VERIFY:"verify",WAITING:"waiting",SUCCESS:"success"},S=({onSubmit:n,paymentData:o,setPaymentData:r,amount:s,isLoading:t,onCancel:a})=>{const l=async c=>{c.preventDefault(),k.event("Payment","Initiate",`GH₵${s}`),n(c)},h=()=>{k.event("Payment","Cancel",`GH₵${s}`),a()};return e.jsxs("div",{className:"p-6 bg-white rounded-lg",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Payment Details"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount to Pay"}),e.jsx("input",{type:"text",value:`GH₵${s}`,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Network"}),e.jsxs("select",{value:o.channel,onChange:c=>r(m=>({...m,channel:c.target.value})),className:"w-full p-2 border border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Select network"}),Object.entries(Y).map(([c,m])=>e.jsx("option",{value:m,children:c.replace("_"," ")},m))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mobile Number"}),e.jsx("input",{type:"tel",value:o.payer,onChange:c=>r(m=>({...m,payer:c.target.value})),className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"Enter mobile number",required:!0})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"submit",disabled:t,className:`flex-1 bg-dark text-white py-2 px-4 rounded-md hover:bg-darkYellow hover:text-dark\r
                        transition-colors disabled:opacity-40 disabled:cursor-not-allowed`,children:t?"Processing...":"Pay Now"}),e.jsx("button",{type:"button",onClick:h,className:"flex-1 border border-dark text-dark py-2 px-4 rounded-md hover:bg-gray-100",children:"Cancel"})]})]})]})};S.propTypes={onSubmit:i.func.isRequired,paymentData:i.shape({amount:i.number.isRequired,payer:i.string.isRequired,channel:i.string.isRequired}).isRequired,setPaymentData:i.func.isRequired,amount:i.number.isRequired,isLoading:i.bool.isRequired,onCancel:i.func.isRequired};const C=({onSubmit:n,verificationData:o,setVerificationData:r,isLoading:s,onCancel:t})=>{const[a,l]=f.useState(""),h=async m=>{if(m.preventDefault(),l(""),o.otpCode.length!==6){l("Please enter a 6-digit verification code");return}try{await n(m)}catch(x){x.message.includes("Invalid verification code")?l("Invalid verification code. Please check and try again."):x.message.includes("timed out")?l("Verification timed out. Please try again."):l(x.message||"An error occurred. Please try again.")}},c=m=>{const x=m.target.value.replace(/[^0-9]/g,"");x.length<=6&&(r(b=>({...b,otpCode:x})),l(""))};return e.jsxs("div",{className:"p-6 bg-white rounded-lg",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Enter Verification Code"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please enter the 6-digit verification code sent to your phone."}),a&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md",children:a}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"otpCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"Verification Code"}),e.jsx("input",{id:"otpCode",type:"text",value:o.otpCode,onChange:c,className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-darkYellow focus:border-transparent",placeholder:"Enter 6-digit code",maxLength:6,required:!0})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("button",{type:"submit",disabled:s||o.otpCode.length!==6,className:`flex-1 bg-dark text-white py-3 px-4 rounded-md hover:bg-darkYellow hover:text-dark\r
                      transition-colors disabled:opacity-50 disabled:cursor-not-allowed`,children:s?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify Code"}),e.jsx("button",{type:"button",onClick:t,className:"flex-1 border border-dark text-dark py-3 px-4 rounded-md hover:bg-gray-100 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:t,className:"text-dark hover:text-darkYellow text-sm underline",children:"Didn't receive code? Try again"})})]})};C.propTypes={onSubmit:i.func.isRequired,verificationData:i.shape({externalRef:i.string.isRequired,otpCode:i.string.isRequired}).isRequired,setVerificationData:i.func.isRequired,isLoading:i.bool.isRequired,onCancel:i.func.isRequired};const E=({onCancel:n})=>e.jsxs("div",{className:"p-6 bg-white rounded-lg text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-dark mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Waiting for Payment Approval"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Please approve the payment prompt on your phone."}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"This may take a few moments. Please don't close this window."}),e.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to cancel the payment?")&&n()},className:"text-dark hover:text-darkYellow underline",children:"Cancel Payment"})]});E.propTypes={onCancel:i.func.isRequired};const I=({transactionDetails:n,amount:o,onClose:r})=>{A();const s=()=>{r==null||r();const t="https://delkomcharityfoundation.com/";window.location.href=t};return e.jsxs("div",{className:"p-6 bg-white rounded-lg text-center",children:[e.jsx("div",{className:"text-green-500 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-green-600",children:"Payment Successful!"}),e.jsxs("div",{className:"text-gray-600 space-y-2 mb-6",children:[e.jsxs("p",{children:["Amount: GH₵",(n==null?void 0:n.amount)||o]}),(n==null?void 0:n.transactionId)&&e.jsxs("p",{children:["Transaction ID: ",n.transactionId]}),(n==null?void 0:n.payer)&&e.jsxs("p",{children:["Phone Number: ",n.payer]})]}),e.jsxs("div",{className:"flex space-x-4 justify-center",children:[e.jsx("button",{onClick:s,className:`bg-dark text-white py-2 px-4 rounded-md \r
                    hover:bg-darkYellow hover:text-dark transition-colors`,children:"Go to Home"}),e.jsx("button",{onClick:r,className:`border border-dark text-dark py-2 px-4 rounded-md \r
                    hover:bg-gray-100 transition-colors`,children:"Stay Here"})]})]})};I.propTypes={transactionDetails:i.shape({amount:i.number,transactionId:i.string,payer:i.string}),amount:i.number.isRequired,onClose:i.func.isRequired};const w={TP15:"Invalid verification code. Please check and try again.",INVALID_OTP_LENGTH:"Please enter a 6-digit verification code.",INVALID_PHONE:"Please enter a valid phone number.",DEFAULT:"An error occurred. Please try again."},q=async n=>{var o;try{const r={amount:parseFloat(n.amount),payer:n.payer.replace(/\s+/g,""),channel:parseInt(n.channel)};return(await P.post("/payment",r)).data}catch(r){const s=(o=r.response)==null?void 0:o.data;throw s!=null&&s.errors&&s.errors[0].path==="payer"?new Error("Please enter a valid phone number"):new Error((s==null?void 0:s.message)||w.DEFAULT)}},L=async(n,o)=>{var r,s;try{if(o.length!==6)throw new Error(w.INVALID_OTP_LENGTH);const t={externalRef:n,otpcode:o};return(await P.post("/verify",t)).data}catch(t){const a=(r=t.response)==null?void 0:r.data;throw((s=a==null?void 0:a.response)==null?void 0:s.code)==="TP15"?new Error(w.TP15):a!=null&&a.errors&&a.errors[0].path==="otpcode"?new Error(w.INVALID_OTP_LENGTH):new Error((a==null?void 0:a.message)||w.DEFAULT)}},H=async n=>{var o,r,s;try{const t=await P.post("/status",{externalRef:n});console.log("Status Response:",t.data);const a=((o=t.data.data)==null?void 0:o.paymentStatus)==="Successful",l=((r=t.data.data)==null?void 0:r.paymentStatus)==="Pending";return{success:a,pending:l,data:t.data.data,message:t.data.message}}catch(t){const a=(s=t.response)==null?void 0:s.data;return a!=null&&a.data?{success:!1,pending:!1,data:a.data,message:a.message||"Payment check failed"}:{success:!1,pending:!1,data:null,message:w.DEFAULT}}},V=async(n,o=30)=>{let r=0;const s=async()=>{try{if(r>=o)throw new Error("Payment verification timed out. Please check your transaction status later.");const t=await H(n);if(console.log("Poll result:",t),t.success)return t;if(!t.pending)throw new Error(t.message||"Payment failed. Please try again.");return r++,await new Promise(a=>setTimeout(a,8e3)),s()}catch(t){if(t.message.includes("timeout"))throw t;if(r<o)return r++,await new Promise(a=>setTimeout(a,8e3)),s();throw new Error("Payment verification failed. Please contact support if amount was deducted.")}};return s()},G=n=>{const[o,r]=f.useState(p.INITIATE),[s,t]=f.useState(!1),[a,l]=f.useState({amount:n,payer:"",channel:""}),[h,c]=f.useState({externalRef:"",otpCode:""}),[m,x]=f.useState(null);return{step:o,setStep:r,isLoading:s,paymentData:a,setPaymentData:l,verificationData:h,setVerificationData:c,transactionDetails:m,handlePaymentSubmit:async g=>{var d,u;g.preventDefault(),t(!0);try{const j=await q(a);c(R=>({...R,externalRef:j.externalRef})),y.success(j.message),r(p.VERIFY)}catch(j){y.error(((u=(d=j.response)==null?void 0:d.data)==null?void 0:u.message)||"Payment initiation failed")}finally{t(!1)}},handleVerification:async g=>{g.preventDefault(),t(!0);try{const d=await L(h.externalRef,h.otpCode);y.info("Please approve the payment on your phone"),r(p.WAITING);const u=await V(h.externalRef);u.success?(x(u.data),y.success(u.message||"Payment completed successfully!"),r(p.SUCCESS)):(y.error(u.message||"Payment was not completed"),r(p.INITIATE))}catch(d){y.error(d.message||"Verification failed"),r(p.VERIFY)}finally{t(!1)}}}},T=({amount:n,onSuccess:o,onCancel:r})=>{const{step:s,setStep:t,isLoading:a,paymentData:l,setPaymentData:h,verificationData:c,setVerificationData:m,transactionDetails:x,handlePaymentSubmit:b,handleVerification:v}=G(n),g=()=>{t(p.INITIATE),r()},d=()=>{o==null||o(x)};switch(s){case p.VERIFY:return e.jsx(C,{onSubmit:v,verificationData:c,setVerificationData:m,isLoading:a,onCancel:g});case p.WAITING:return e.jsx(E,{onCancel:()=>t(p.INITIATE)});case p.SUCCESS:return e.jsx(I,{transactionDetails:x,amount:n,onClose:d});default:return e.jsx(S,{onSubmit:b,paymentData:l,setPaymentData:h,amount:n,isLoading:a,onCancel:g})}};T.propTypes={amount:i.number.isRequired,onSuccess:i.func,onCancel:i.func.isRequired};const F="/assets/books-9e9fd7f6.jpg",D="/assets/cloths-a372c3b2.jpg",M="/assets/foodd-23cd5805.jpg",W=()=>{const[n,o]=f.useState(!1),[r,s]=f.useState(null),[t,a]=f.useState(""),l={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},h=d=>{s(d),o(!0)},c=d=>{const u=d.target.value;(u===""||parseFloat(u)>=0)&&a(u)},m=d=>{d.preventDefault();const u=parseFloat(t);if(!u||isNaN(u)){y.error("Please enter a valid amount");return}if(u<2){y.error("Minimum donation amount is GH₵2");return}s(u),o(!0)},x=d=>{y.success(`Thank you for your donation of GH₵${d.amount}!`),o(!1),a(""),s(null)},b=()=>{o(!1),s(null)},v=()=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Complete Your Donation"}),e.jsx(T,{amount:r,onSuccess:x,onCancel:b})]})})}),g=[10,20,50,100];return f.useEffect(()=>{k.pageview()},[]),e.jsxs("div",{className:"bg-overlayPrimary min-h-screen py-12 md:py-16",children:[e.jsxs("div",{className:"w-[90%] md:w-[80%] mx-auto",children:[e.jsxs("h1",{className:"headings font-bold mb-6 text-center text-white",children:["Make a ",e.jsx("span",{className:"text-darkYellow",children:"Donation"})]}),e.jsxs("h2",{className:"text-2xl font-semibold mb-8 text-center text-gray-300",children:["Fundraising ",e.jsx("span",{className:"text-darkYellow",children:"Categories"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 mb-12",children:[e.jsxs(N.div,{className:"bg-primary p-8 sm:p-6 rounded-md shadow-md w-[95%] mx-auto md:w-full",initial:"hidden",animate:"visible",variants:l,transition:{duration:.5},children:[e.jsx("img",{src:F,alt:"Buy Stationery",className:"w-full h-52 sm:h-48 object-cover rounded-sm mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-dark mb-2",children:"Donate Stationery"}),e.jsx("p",{className:"text-overlay mb-4",children:"Help us provide essential stationery for children."}),e.jsx("button",{onClick:()=>h(15),className:"w-full bg-dark text-white hover:bg-darkYellow hover:text-dark py-3 sm:py-2 px-4 rounded-lg transition duration-300",children:"Donate GH₵15"})]}),e.jsxs(N.div,{className:"bg-primary p-8 sm:p-6 rounded-md shadow-md w-[95%] mx-auto md:w-full",initial:"hidden",animate:"visible",variants:l,transition:{duration:.5},children:[e.jsx("img",{src:D,alt:"Donate Clothing",className:"w-full h-52 sm:h-48 object-cover rounded-sm mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-dark mb-2",children:"Donate Clothing"}),e.jsx("p",{className:"text-overlay mb-4",children:"Support our clothing drive for those in need."}),e.jsx("button",{onClick:()=>h(20),className:"w-full bg-dark hover:bg-darkYellow text-white hover:text-dark py-3 sm:py-2 px-4 rounded-lg transition duration-300",children:"Donate GH₵20"})]}),e.jsxs(N.div,{className:"bg-primary p-8 sm:p-6 rounded-md shadow-md w-[95%] mx-auto md:w-full",initial:"hidden",animate:"visible",variants:l,transition:{duration:.5},children:[e.jsx("img",{src:M,alt:"Donate Food",className:"w-full h-52 sm:h-48 object-cover rounded-sm mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-dark mb-2",children:"Donate Food"}),e.jsx("p",{className:"text-overlay mb-4",children:"Help us provide meals for families in need."}),e.jsx("button",{onClick:()=>h(20),className:"w-full bg-dark hover:bg-darkYellow text-white hover:text-dark py-3 sm:py-2 px-4 rounded-lg transition duration-300",children:"Donate GH₵20"})]})]}),e.jsxs("div",{className:"bg-darkShade shadow-lg rounded-lg p-6 md:p-8 max-w-2xl mx-auto mb-8",children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-6 text-center text-white",children:["Suggested ",e.jsx("span",{className:"text-darkYellow",children:"Amounts"})]}),e.jsx("div",{className:"flex flex-wrap justify-center gap-4",children:g.map(d=>e.jsxs(N.button,{onClick:()=>h(d),className:`bg-dark text-white py-4 px-8 rounded-lg \r
									 hover:bg-darkYellow hover:text-dark \r
									 transition-colors text-lg font-semibold\r
									 min-w-[120px]`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:["GH₵",d]},d))})]}),e.jsxs("div",{className:"bg-darkShade shadow-lg rounded-lg p-8 max-w-2xl mx-auto",children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-6 text-center text-primary",children:["Custom Donation ",e.jsx("span",{className:"text-darkYellow",children:"Amount"})]}),e.jsxs("form",{onSubmit:m,className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-full max-w-xs mb-4",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"GH₵"}),e.jsx("input",{type:"number",step:"any",value:t,onChange:c,placeholder:"Enter amount (min. GH₵2)",className:`w-full pl-12 pr-4 py-3 rounded-lg\r
										 focus:outline-none focus:ring-2 focus:ring-darkYellow \r
										 text-gray-900`})]}),e.jsx("button",{type:"submit",className:`w-full max-w-xs bg-darkYellow text-dark hover:bg-dark \r
									 hover:text-white py-3 px-4 rounded-lg \r
									 transition duration-300`,children:"Donate"})]})]})]}),n&&e.jsx(v,{})]})};export{W as default};
